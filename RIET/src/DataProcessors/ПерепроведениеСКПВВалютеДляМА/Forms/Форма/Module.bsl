
&НаКлиенте
Процедура СчетКнигиПокупокНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
    СтандартнаяОбработка = Ложь;
	
	СтруктураНастройки = Новый Структура;
	СтруктураНастройки.Вставить("Имя", "ВыборИзОбработкиПерепроведениеСКПДляМА");
		
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("СтруктураНастройки", СтруктураНастройки);
	ОткрытьФорму("Документ.СчетКнигиПокупок.Форма.ФормаВыбораУправляемая", ПараметрыФормы, Элемент);	
	
КонецПроцедуры

&НаКлиенте
Процедура ПерепровестиПоРегиструМА(Команда)
	
	Отказ = Ложь;
	
	Если НЕ ЗначениеЗаполнено(Объект.СчетКнигиПокупок) Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
			"Не выбран документ ""Счет книги покупок""!",
			, "СчетКнигиПокупок", "Объект", Отказ);
	КонецЕсли;          
	
	Если НЕ ЗначениеЗаполнено(Объект.СуммаРубСНДС) Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
			"Не заполнено значение ""Сумма руб. с НДС""!",
			, "СуммаРубСНДС", "Объект", Отказ);
	КонецЕсли;
	
	Если Отказ Тогда 
		Возврат;
	КонецЕсли;
	
	ПерепровестиПоРегиструМАНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПерепровестиПоРегиструМАНаСервере()
	
	НачатьТранзакцию();
	
	Документы.СчетКнигиПокупок.СформироватьДвиженияПоРегиструМатериальныеАктивыДляУказаннойСуммыРуб(
					Объект.СчетКнигиПокупок, Объект.СчетКнигиПокупок.ДатаПроведения, Объект.СуммаРубСНДС);
	
	ЗафиксироватьТранзакцию();
	Сообщить("Документ <"+ Объект.СчетКнигиПокупок +"> перепроведен.", СтатусСообщения.Информация);
	              		 	
КонецПроцедуры
