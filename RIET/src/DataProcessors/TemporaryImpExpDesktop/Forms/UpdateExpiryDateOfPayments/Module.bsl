
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Items") Тогда 
		СписокTempItems.ЗагрузитьЗначения(Параметры.Items);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Update(Команда)
	
	UpdateНаСервере();
	
	Оповестить("UpdateExpiryDateOfPayments");
	
	Закрыть();
	
КонецПроцедуры

&НаСервере
Процедура UpdateНаСервере()
	
	УстановитьПривилегированныйРежим(Истина);
	
	Для Каждого СтрокаItem из СписокTempItems Цикл 
		
		МенеджерЗаписи = РегистрыСведений.ExpiryDatesOfPaymentsOfTemporaryItems.СоздатьМенеджерЗаписи();
		МенеджерЗаписи.Item = СтрокаItem.Значение;
		МенеджерЗаписи.Прочитать();
		
		Если МенеджерЗаписи.Выбран() Тогда
			
			Если Не ЗначениеЗаполнено(ExpiryDate) Тогда 
				МенеджерЗаписи.Удалить();
				Продолжить;
			КонецЕсли;
			
		иначе
			
			МенеджерЗаписи.Item = СтрокаItem.Значение;
			
		КонецЕсли;
		
		МенеджерЗаписи.ExpiryDateOfPayments = ExpiryDate;
		
		МенеджерЗаписи.Записать();
		
	КонецЦикла;
	
КонецПроцедуры
