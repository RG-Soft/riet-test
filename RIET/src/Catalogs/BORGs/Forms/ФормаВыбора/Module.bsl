
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("СтруктураНастройки") Тогда
		
		СтруктураНастройки = Параметры.СтруктураНастройки;
		Если СтруктураНастройки.Имя = "ВыборИзAUsAndBORGs" Тогда
			НастроитьДляВыбораИзAUsAndBORGs(СтруктураНастройки);
		КонецЕсли;
		
	КонецЕсли;
	
	Отбор = Параметры.Отбор;
	
	Отбор.Вставить("ПометкаУдаления", Ложь);	
		
КонецПроцедуры

&НаСервере
Процедура НастроитьДляВыбораИзAUsAndBORGs(СтруктураНастройки)
	
	Если ЗначениеЗаполнено(СтруктураНастройки.AU) Тогда
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("AU", СтруктураНастройки.AU);
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	AUsAndBORGs.BORG
			|ИЗ
			|	РегистрСведений.AUsAndBORGs КАК AUsAndBORGs
			|ГДЕ AUsAndBORGs.AU <> &AU";
			
		МассивЗапрещенныхBORGs = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("BORG");
		Если МассивЗапрещенныхBORGs.Количество() Тогда
			
			СписокЗапрещенныхBORGs = Новый СписокЗначений;
			СписокЗапрещенныхBORGs.ЗагрузитьЗначения(МассивЗапрещенныхBORGs);
			
			ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(
				Список.Отбор,
				"Ссылка",
				СписокЗапрещенныхBORGs,
				ВидСравненияКомпоновкиДанных.НеВСписке,
				,
				Истина);
			
		КонецЕсли; 
				
	КонецЕсли; 
	
КонецПроцедуры
