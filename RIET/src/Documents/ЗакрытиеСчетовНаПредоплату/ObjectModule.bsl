//Добавил РГ-Софт - Пронин Иван
Перем мУдалятьДвижения;
//Конец добавления

Процедура ОбработкаПроведения(Отказ, Режим)
	//Добавил РГ-Софт - Пронин Иван
	Если мУдалятьДвижения Тогда
		ОбщегоНазначения.УдалитьДвиженияРегистратора(ЭтотОбъект, Отказ,, Истина);
	КонецЕсли;
	//Конец добавления
	
	Для Каждого ТекСтрокаСчета Из Счета Цикл

		Если  ТекСтрокаСчета.СчетНаОплату.ВидОперации = Перечисления.ВидыОперацийСчетНаОплатуПокупателю.СчетНаОплату Тогда
			
			Сообщить("Счет "+ ТекСтрокаСчета.СчетНаОплату + " не является счетом на предоплату!");
			Отказ=Истина;
		КонецЕсли;	
		
	КонецЦикла;	
	
	Если не Отказ Тогда
	Для Каждого ТекСтрокаСчета Из Счета Цикл
		// register СчетаНаПредоплату Расход
		Движение = Движения.СчетаНаПредоплату.Добавить();
		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
		Движение.Период = Дата;
		Движение.ПодразделениеОрганизации = ПодразделениеОрганизации;
		Движение.ДоговорКонтрагента = ДоговорКонтрагента;
		Движение.СчетНаОплату = ТекСтрокаСчета.СчетНаОплату;
		Движение.СуммаРегл = ТекСтрокаСчета.СуммаВзаиморасчетов*ТекСтрокаСчета.КурсВзаиморасчетов;
		Движение.СуммаВзаиморасчетов = ТекСтрокаСчета.СуммаВзаиморасчетов;
	КонецЦикла;
	// writing register movements
	Движения.СчетаНаПредоплату.Записать();
    КонецЕсли;
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;

	мУдалятьДвижения = НЕ ЭтоНовый();
	
КонецПроцедуры

//Добавил РГ-Софт - Пронин Иван
Процедура ОбработкаУдаленияПроведения(Отказ)
	
	ОбщегоНазначения.УдалитьДвиженияРегистратора(ЭтотОбъект, Отказ,, Истина);
	
КонецПроцедуры
