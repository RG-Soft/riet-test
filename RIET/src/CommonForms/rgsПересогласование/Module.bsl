
&НаСервере
Процедура ВыполнитьПослеЗакрытияФормы(РезультатЗакрытия, ДополнительныеПараметры) Экспорт
	
	
	
КонецПроцедуры	

&НаКлиенте
Процедура ЗапросПересогласование(Команда)
	
	ЗапросОтказ = ЗапросПересогласованиеНаСервере(ЭтаФорма.ВладелецФормы.Объект.Ссылка);
	
	Если ЗапросОтказ Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Запрос не отправлен. Обратитесь к администратору ICO.";
		Сообщение.Сообщить();
	Иначе
		ЭтаФорма.Закрыть();
		ПоказатьОповещениеПользователя("Запрос на пересогласование документа отправлен.");
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ЗапросПересогласованиеНаСервере(ИсточникСсылка)

	Отказ = Ложь;
	ТекстОшибки = "";
	
	ТекстСообщения = СообщениеДляОтветственного;
	СсылкаНаОбъект = ИсточникСсылка;
	СтруктураДанных = Новый Структура;
	СтруктураДанных.Вставить("ТипОбъекта",		"Документ." + СсылкаНаОбъект.Метаданные().Имя);
	СтруктураДанных.Вставить("УникальныйИдентификатор", Строка(СсылкаНаОбъект.УникальныйИдентификатор()));
	СтруктураДанных.Вставить("Пользователь", 	СокрЛП(Пользователи.ТекущийПользователь()));
	СтруктураДанных.Вставить("СообщениеДляОтветственного", СообщениеДляОтветственного);
	СтруктураДанных.Вставить("База", "SVS");
	СтруктураДанных = СериализаторXDTO.ЗаписатьXDTO(СтруктураДанных);
	
	Ответ = rgsКонтрольПроведенияСервер.ДействиеМодуляКонтроля("QueryRematching", Отказ, ТекстОшибки, СтруктураДанных);
	
	Если НЕ Ответ.Отказ Тогда 
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Запрос на пересогласование успешно отправлен.";
		Сообщение.Сообщить();
	КонецЕсли;

	Возврат Ответ.Отказ;
	
КонецФункции

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Сообщение = Новый СообщениеПользователю;
	Сообщение.Текст = "Отмена проведения невозможна!!! Сформируйте запрос на пересоогалсование.";
	Сообщение.Сообщить();
	
КонецПроцедуры


&НаКлиенте
Процедура ПриЗакрытии(ЗавершениеРаботы)
	
	//ПоказатьОповещениеПользователя("Запрос на пересогласование документа отправлен.");
	
КонецПроцедуры

